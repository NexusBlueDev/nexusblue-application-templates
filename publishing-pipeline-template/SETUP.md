# NexusBlue App Store Publishing Pipeline
## Capacitor + GitHub Actions — Multi-App Strategy

Set this up ONCE per app. Every future NexusBlue app reuses the same approach with 4 config changes.

---

## Overview

| What | How |
|------|-----|
| Web app (PWA) | Your existing HTML/CSS/JS, unchanged |
| Native wrapper | Capacitor — wraps your web app in a native shell |
| Android build | GitHub Actions (Ubuntu runner — free) |
| iOS build | GitHub Actions (macOS runner — free) |
| Signing | Android: keystore file. iOS: Apple certificates |
| Distribution | Google Play internal track → production. App Store Connect → TestFlight → production |

---

## One-Time Costs (Covers All Future NexusBlue Apps)

| Item | Cost |
|------|------|
| Google Play Developer Account | $25 one-time |
| Apple Developer Program | $99/year |
| GitHub Actions (public repos) | Free |
| Capacitor | Free (open source) |

---

## Prerequisites

- Node.js v20+ installed locally (just for initial setup, not for builds)
- App already live on GitHub Pages
- GitHub repository under `github.com/NexusBlueDev/[REPO-NAME]`

---

## Step-by-Step Setup (Do Once Per App)

### Step 1: Initialize npm and install Capacitor

Run in your app's root directory:

```bash
npm init -y
npm install @capacitor/core @capacitor/cli @capacitor/android @capacitor/ios
npx cap init "[App Name]" "com.nexusblue.[appname]" --web-dir "."
```

Replace:
- `[App Name]` — e.g. "Junior Jarvis Career"
- `com.nexusblue.[appname]` — e.g. "com.nexusblue.juniorjarviscareer"

### Step 2: Create capacitor.config.json

Copy `capacitor.config.json` from this template and update:
- `appId` — your app ID
- `appName` — your app name

### Step 3: Add platforms

```bash
npx cap add android
npx cap add ios
npx cap sync
```

This generates the `android/` and `ios/` directories.

### Step 4: Add to .gitignore

Add these lines to `.gitignore`:

```
node_modules/
android/
ios/
```

The `android/` and `ios/` directories are regenerated by GitHub Actions — don't commit them.

### Step 5: Generate Android signing keystore (one-time for all NexusBlue apps)

Run this once. Save the keystore file and passwords in your password manager — if you lose them, you can never update the app on Google Play.

```bash
keytool -genkey -v \
  -keystore nexusblue.keystore \
  -alias nexusblue \
  -keyalg RSA \
  -keysize 2048 \
  -validity 10000
```

Then base64-encode it for GitHub Secrets:

```bash
# Mac/Linux:
base64 -i nexusblue.keystore | tr -d '\n'

# Windows PowerShell:
[Convert]::ToBase64String([IO.File]::ReadAllBytes("nexusblue.keystore"))
```

Store the output as the `ANDROID_SIGNING_KEY` secret.

**The same keystore can be reused across ALL NexusBlue apps.**

### Step 6: Add GitHub Actions workflows

Copy the workflow files from this template:
- `.github/workflows/android.yml` → your repo
- `.github/workflows/ios.yml` → your repo

Update in each file:
- `packageName: com.nexusblue.[appname]` (in android.yml)
- `bundle-id: com.nexusblue.[appname]` (in ios.yml)

### Step 7: Add GitHub Secrets

Go to your repo → Settings → Secrets and variables → Actions → New repository secret.

See `SECRETS_CHECKLIST.md` for all required secrets and how to get each one.

### Step 8: Push and watch it build

```bash
git add .
git commit -m "feat: add Capacitor publishing pipeline"
git push origin main
```

Watch the build in GitHub → Actions tab. Both pipelines trigger automatically.

---

## Reusing for a New App

When building the next NexusBlue app:

1. Copy `capacitor.config.json` and change `appId` and `appName`
2. Copy both workflow files and update `packageName` / `bundle-id`
3. Add the same GitHub secrets to the new repo (Android keystore is shared)
4. Run `npm install` + `npx cap add android` + `npx cap add ios` + `npx cap sync`
5. Push to `main` — both stores get the build automatically

**The Android keystore (`nexusblue.keystore`) is shared across all NexusBlue apps.**
Store it securely. Never commit it to git. Never lose it.

---

## iOS Setup Requirements

iOS builds require more one-time setup in Apple's systems:

1. **Apple Developer Account** — enroll at developer.apple.com ($99/year)
2. **App ID** — create in Identifiers section: `com.nexusblue.[appname]`
3. **Distribution Certificate** — create in Certificates section, download + export as `.p12`
4. **App Store Connect entry** — create the app in App Store Connect before first upload
5. **Provisioning Profile** — handled automatically by the workflow via API key

### iOS API Key (one-time for all apps)
In App Store Connect → Users and Access → Integrations → App Store Connect API:
- Create a key with "App Manager" role
- Download the `.p8` file (only downloadable once)
- Note the Key ID and Issuer ID

---

## Web Speech API Notes for Native Apps

- **Android**: Works natively in WebView. No changes needed.
- **iOS**: Requires entries in `Info.plist` for TTS. Edit `ios/App/App/Info.plist`:

```xml
<key>NSMicrophoneUsageDescription</key>
<string>Used for voice interaction with Junior Jarvis</string>
<key>NSSpeechRecognitionUsageDescription</key>
<string>Used for voice interaction with Junior Jarvis</string>
```

Add this before the closing `</dict>` tag in Info.plist.

---

## Quick Reference

| Scenario | Best Approach |
|----------|--------------|
| Expo booth today | GitHub Pages URL in Chrome fullscreen |
| Share with parents | QR code → GitHub Pages URL |
| Android distribution | Google Play via this pipeline |
| iOS distribution | App Store via this pipeline |
| Testing before release | Internal track (Play) / TestFlight (iOS) |
